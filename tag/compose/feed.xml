<?xml version="1.0" encoding="utf-8"?>

<feed xmlns="http://www.w3.org/2005/Atom" >
  <generator uri="https://jekyllrb.com/" version="3.9.3">Jekyll</generator>
  <link href="https://manuelvivo.dev/tag/compose/feed.xml" rel="self" type="application/atom+xml" />
  <link href="https://manuelvivo.dev/" rel="alternate" type="text/html" />
  <updated>2025-07-07T10:14:22+00:00</updated>
  <id>https://manuelvivo.dev/tag/compose/feed.xml</id>

  
  
  

  
    <title type="html">Manuel Vivo .dev | </title>
  

  
    <subtitle>A place where you can learn about Android development</subtitle>
  

  

  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
  

  
    <entry>
      <title type="html">Migrating Architecture Blueprints to Jetpack Compose</title>
      <link href="https://manuelvivo.dev/blueprints-migration-compose" rel="alternate" type="text/html" title="Migrating Architecture Blueprints to Jetpack Compose" />
      <published>2022-04-11T00:00:00+00:00</published>
      <updated>2022-04-11T00:00:00+00:00</updated>
      <id>https://manuelvivo.dev/blueprints-migration-compose</id>
      <content type="html" xml:base="https://manuelvivo.dev/blueprints-migration-compose">&lt;p&gt;This blog post tells the story of how the team migrated Architecture Blueprints to Jetpack Compose.&lt;/p&gt;

&lt;p&gt;As part of our effort to modernize the &lt;a href=&quot;http://goo.gle/mad-architecture-guide&quot;&gt;app architecture guidance&lt;/a&gt;, we want to experiment with different UI patterns to see what works best, find similarities and differences between the alternatives, and ultimately consolidate those learnings as best practices.&lt;/p&gt;

&lt;p&gt;To make our findings as easy to follow as possible, we needed a sample that has a familiar business case and isn‚Äôt too complicated. And‚Ä¶ who doesn‚Äôt know about &lt;em&gt;TODO&lt;/em&gt; apps? We chose &lt;a href=&quot;https://github.com/android/architecture-samples&quot;&gt;Architecture Blueprints&lt;/a&gt;! Historically, Blueprints served as an experimental playground for architecture choices. What a great fit for this as well!&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
  &lt;img src=&quot;assets/images/2022-04-11-blueprints-migration-compose-1.gif&quot; /&gt;
  &lt;small&gt;Architecture Blueprints app in action&lt;/small&gt;
&lt;/p&gt;

&lt;p&gt;The patterns we want to experiment with are obviously affected by the different APIs available nowadays. The new kids in town are &lt;a href=&quot;https://developer.android.com/jetpack/compose/state&quot;&gt;Jetpack Compose‚Äôs State APIs&lt;/a&gt;! As Compose seamlessly works with any &lt;a href=&quot;https://developer.android.com/jetpack/guide/ui-layer#udf&quot;&gt;&lt;em&gt;Unidirectional Data Flow&lt;/em&gt; pattern&lt;/a&gt;, we‚Äôll use Compose to render UI to make a fair comparison.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;This blog post tells the story of how the team migrated Architecture Blueprints to Jetpack Compose&lt;/strong&gt;. As &lt;a href=&quot;https://developer.android.com/topic/libraries/architecture/livedata&quot;&gt;LiveData&lt;/a&gt; is also considered an alternative in our experiments, we left the sample as it was at the time of the migration. &lt;strong&gt;In this refactoring, the ViewModel classes and the data layer were left untouched.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;‚ö†Ô∏è The architecture used in this LiveData-based codebase doesn‚Äôt fully follow the &lt;a href=&quot;http://goo.gle/mad-architecture-guide&quot;&gt;latest architecture best practices&lt;/a&gt;. In particular, LiveData &lt;strong&gt;shouldn‚Äôt&lt;/strong&gt; be used in the &lt;a href=&quot;https://developer.android.com/jetpack/guide/data-layer&quot;&gt;data&lt;/a&gt; or &lt;a href=&quot;https://developer.android.com/jetpack/guide/domain-layer&quot;&gt;domain&lt;/a&gt; layers ‚Äî Flows and coroutines should be used instead.&lt;/p&gt;

&lt;p&gt;Now that the context is clear, let‚Äôs dive in on how we approached refactoring Blueprints to Jetpack Compose. You can check out the full code on the &lt;a href=&quot;https://github.com/android/architecture-samples&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;main&lt;/code&gt; branch&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;Ô∏è-planning-a-gradual-migration&quot;&gt;‚úçÔ∏è Planning a gradual migration&lt;/h2&gt;

&lt;p&gt;Before doing any &lt;em&gt;actual&lt;/em&gt; coding work, the team created a migration plan to make sure everyone was on board with the proposed changes. The ultimate goal was to have Blueprints as a single-activity application with screens as composable functions, and using the recommended &lt;a href=&quot;https://developer.android.com/jetpack/compose/navigation&quot;&gt;Compose Navigation&lt;/a&gt; library to move between screens.&lt;/p&gt;

&lt;p&gt;Luckily, Blueprints was already a single-activity app that used &lt;a href=&quot;https://developer.android.com/guide/navigation&quot;&gt;Jetpack Navigation&lt;/a&gt; to move between different screens implemented with Fragments. To migrate to Compose, we followed the &lt;a href=&quot;https://developer.android.com/jetpack/compose/navigation#interoperability&quot;&gt;Navigation interoperability guidance&lt;/a&gt; that recommends hybrid apps to use the fragment-based Navigation component and use fragments to hold view-based screens, Compose screens, and screens that use both views and Compose. Unfortunately, it‚Äôs not possible to mix Fragment and Compose destinations in the same Navigation graph.&lt;/p&gt;

&lt;p&gt;The goal of a gradual migration is to ease code reviews and maintain a shippable product throughout the migration. The migration plan involved three steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Migrate the content of each screen to Compose. Each screen could be individually migrated to Compose, including their UI tests. Fragments then become the container/host of each migrated screen.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Migrate the app to Navigation Compose ‚Äî which removes all Fragments from the project ‚Äî and migrate the Activity UI logic to root composables. End-to-end tests are also migrated at this point.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Remove View system dependencies.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;And that‚Äôs what we did! üßë‚Äçüíª Fast-forward ‚è© two weeks, we migrated the &lt;em&gt;Statistics&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/821&quot;&gt;PR&lt;/a&gt;), &lt;em&gt;Add/Edit task&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/823&quot;&gt;PR&lt;/a&gt;), &lt;em&gt;Task detail&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/822&quot;&gt;PR&lt;/a&gt;), and the &lt;em&gt;Tasks&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/826&quot;&gt;PR&lt;/a&gt;); and we merged the &lt;a href=&quot;https://github.com/android/architecture-samples/pull/827&quot;&gt;final PR&lt;/a&gt; which migrated Navigation and Activity logic to Compose, including &lt;a href=&quot;https://github.com/android/architecture-samples/pull/827/commits/2810a37c479ef4b23b4cabf095c55df7b342235e&quot;&gt;removing unused View system dependencies&lt;/a&gt;.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
  &lt;img width=&quot;800&quot; src=&quot;assets/images/2022-04-11-blueprints-migration-compose-2.png&quot; /&gt;
  &lt;small&gt;How we gradually migrated Blueprints to Compose&lt;/small&gt;
&lt;/p&gt;

&lt;h2 id=&quot;-migration-highlights&quot;&gt;üí° Migration highlights&lt;/h2&gt;

&lt;p&gt;During the migration, we encountered some Compose-specific quirks worth highlighting:&lt;/p&gt;

&lt;h3 id=&quot;-ui-tests&quot;&gt;üß™ UI tests&lt;/h3&gt;

&lt;p&gt;Once you start adding Compose to your app, tests that assert Compose UI need to use &lt;a href=&quot;https://developer.android.com/jetpack/compose/testing&quot;&gt;Compose testing APIs&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;For screen-level UI tests&lt;/strong&gt;, instead of using the &lt;a href=&quot;https://developer.android.com/guide/fragments/test#create&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;launchFragmentInContainer&amp;lt;FragmentType&amp;gt;&lt;/code&gt;&lt;/a&gt; API, we used the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;createAndroidComposeRule&amp;lt;ComponentActivity&amp;gt;&lt;/code&gt; API that allows us to grab string resources in tests. &lt;strong&gt;These tests run in both Espresso and Robolectric&lt;/strong&gt;. Because Compose already supports all of this, no extra changes were required. For example, you can compare the code in &lt;a href=&quot;https://github.com/android/architecture-samples/blob/653a563e9fe0874b4ae3fba539ce4b6518a2f796/app/src/sharedTest/java/com/example/android/architecture/blueprints/todoapp/addedittask/AddEditTaskFragmentTest.kt&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddEditTaskFragmentTest&lt;/code&gt;&lt;/a&gt; that was migrated to &lt;a href=&quot;https://github.com/manuelvicnt/architecture-samples/blob/8a203594541b25e5eec2daac63415c05884242ad/app/src/sharedTest/java/com/example/android/architecture/blueprints/todoapp/addedittask/AddEditTaskScreenTest.kt&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddEditTaskScreenTest&lt;/code&gt;&lt;/a&gt;. Note that if you use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ComponentActivity&lt;/code&gt;, you need to depend on the &lt;a href=&quot;https://developer.android.com/jetpack/compose/testing#setup&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;androidx.compose.ui:ui-test-manifest&lt;/code&gt;&lt;/a&gt; artifact.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;For end-to-end or integration tests&lt;/strong&gt;, we didn‚Äôt find any problems either! Thanks to the &lt;strong&gt;Espresso and Compose interoperability&lt;/strong&gt;, we use Espresso assertions to check Views, and Compose APIs to check Compose UI. Here‚Äôs how the &lt;a href=&quot;https://github.com/manuelvicnt/architecture-samples/blob/249a636ea9a3f16aab5c284e3245069ef56a557f/app/src/androidTestMock/java/com/example/android/architecture/blueprints/todoapp/tasks/AppNavigationTest.kt&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AppNavigationTest&lt;/code&gt;&lt;/a&gt; looked at one point during the migration to Compose.&lt;/p&gt;

&lt;h3 id=&quot;-viewmodel-events&quot;&gt;ü§ô ViewModel events&lt;/h3&gt;

&lt;p&gt;We did have problems with the way &lt;a href=&quot;https://developer.android.com/jetpack/guide/ui-layer/events#handle-viewmodel-events&quot;&gt;ViewModel events&lt;/a&gt; were handled in Blueprints. Blueprints implemented an &lt;a href=&quot;https://github.com/android/architecture-samples/blob/8e1e0527a0d043b41da58925a39fb8e03d62829a/app/src/main/java/com/example/android/architecture/blueprints/todoapp/Event.kt&quot;&gt;Event wrapper&lt;/a&gt; solution to send commands from the ViewModel to the UI. However, that‚Äôs not something that works nicely in Compose. Our recent guidance &lt;a href=&quot;https://developer.android.com/jetpack/guide/ui-layer/events#handle-viewmodel-events&quot;&gt;recommends&lt;/a&gt; modeling those ‚Äúevents‚Äù as state, and that‚Äôs what we did during the migration.&lt;/p&gt;

&lt;p&gt;Looking at the &lt;em&gt;showing messages on the screen&lt;/em&gt; event use case, we replaced the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Event&amp;lt;Int&amp;gt;&lt;/code&gt; type of the LiveData to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Int?&lt;/code&gt; This also models the scenario where there is no message to show to the user. In this particular use case, the ViewModel also requires a confirmation from the UI whenever the message has been displayed. See the diff between both implementations in the following code:&lt;/p&gt;

&lt;div class=&quot;language-kotlin highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/* Copyright 2022 Google LLC. 
   SPDX-License-Identifier: Apache-2.0 */&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AddEditTaskViewModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;tasksRepository&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;TasksRepository&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;ViewModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;_snackbarText&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MutableLiveData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;  &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;snackbarText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;LiveData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_snackbarText&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;_snackbarText&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MutableLiveData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;snackbarText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;LiveData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_snackbarText&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;snackbarMessageShown&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;    &lt;span class=&quot;n&quot;&gt;_snackbarText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even though this might seem like more work at first glance, it &lt;strong&gt;guarantees&lt;/strong&gt; that the message is displayed on the screen!&lt;/p&gt;

&lt;p&gt;In the UI code, the way to make sure the event is handled only once is by calling &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;event.getContentIfNotHandled()&lt;/code&gt;. This approach works &lt;em&gt;okayish&lt;/em&gt; in Fragments but &lt;strong&gt;it completely breaks in Compose&lt;/strong&gt; when you are writing natural Compose code! Because recompositions can happen at any time in Compose, the event wrapper is not a valid solution. If the event is processed and the function gets recomposed (something that happened very regularly while testing this approach), then the snackbar will be canceled, and the user might miss the message. That‚Äôs an unacceptable UX issue! &lt;strong&gt;The event wrapper solution shouldn‚Äôt be used in Compose apps&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Note that you can come up with Compose code that avoids recomposing parts of the function in certain scenarios, however, the event wrapper solution is limiting how the UI must be implemented in that case. &lt;strong&gt;Using the event wrapper solution in Compose is discouraged&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;See the following code snippet with the &lt;em&gt;before&lt;/em&gt; (event wrapper) and &lt;em&gt;after&lt;/em&gt; (event as state) code. Because showing messages on the screen is &lt;a href=&quot;https://developer.android.com/jetpack/guide/ui-layer#logic-types&quot;&gt;UI logic&lt;/a&gt; and our screen composables were getting complex, we used a &lt;a href=&quot;https://developer.android.com/jetpack/compose/state#types-of-state-and-logic&quot;&gt;plain state holder class&lt;/a&gt; to manage that complexity (e.g. see &lt;a href=&quot;https://github.com/manuelvicnt/architecture-samples/blob/88cf650fd1759486cce198878b5cf08e823012dc/app/src/main/java/com/example/android/architecture/blueprints/todoapp/addedittask/AddEditTaskState.kt&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AddEditTaskState&lt;/code&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;div class=&quot;language-kotlin highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;/* Copyright 2022 Google LLC. 
   SPDX-License-Identifier: Apache-2.0 */&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// FRAGMENTS CODE CONSUMING THE EVENT WRAPPER SOLUTION&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AddEditTaskFragment&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Fragment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;fun&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onViewCreated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Bundle&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;?)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;     &lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;viewModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;snackbarText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;observe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;lifecycleOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;       &lt;span class=&quot;nc&quot;&gt;Observer&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;         &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getContentIfNotHandled&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;           &lt;span class=&quot;nf&quot;&gt;showSnackbar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;it&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Snackbar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nc&quot;&gt;LENGTH_SHORT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;         &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;       &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;     &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;span class=&quot;c1&quot;&gt;// COMPOSE CODE CONSUMING USER MESSAGES AS STATE&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// State holder for the AddEditTask composable.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// This class handles AddEditTask's UI elements' state and UI logic.&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;AddEditTaskState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;   &lt;span class=&quot;nf&quot;&gt;init&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;     &lt;span class=&quot;c1&quot;&gt;// Listen for snackbar messages&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;     &lt;span class=&quot;n&quot;&gt;viewModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;snackbarText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;observe&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;viewLifecycleOwner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;snackbarMessage&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&amp;gt;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;       &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;snackbarMessage&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;// If there's a previous message showing on the screen&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;       &lt;span class=&quot;c1&quot;&gt;// stop showing it in favor of the new one to be displayed&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;currentSnackbarJob&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;?.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;       &lt;span class=&quot;kd&quot;&gt;val&lt;/span&gt; &lt;span class=&quot;py&quot;&gt;snackbarText&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;getString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;snackbarMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;currentSnackbarJob&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coroutineScope&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;launch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;         &lt;span class=&quot;n&quot;&gt;scaffoldState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;snackbarHostState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;showSnackbar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;snackbarText&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;         &lt;span class=&quot;n&quot;&gt;viewModel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;snackbarMessageShown&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;       &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;     &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;   &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;-when-in-doubt-choose-app-correctness&quot;&gt;üëå When in doubt, choose app correctness&lt;/h3&gt;

&lt;p&gt;While refactoring, it might be tempting to migrate &lt;em&gt;everything&lt;/em&gt; at hand to Compose. While that‚Äôs totally fine, you shouldn‚Äôt sacrifice your app‚Äôs User Experience or correctness. The whole point of doing a gradual migration is that the app is always in a shippable state.&lt;/p&gt;

&lt;p&gt;This happened to us while migrating some screens to Compose. We didn‚Äôt want to do too many migrations at the same time, and migrated some of the screens to Compose &lt;em&gt;before&lt;/em&gt; migrating from the Event wrapper. Instead of handling the Event wrapper in Compose and providing a suboptimal experience, we kept handling those messages in the Fragment while the rest of the code for the screen was in Compose. See, for example, the state of the &lt;a href=&quot;https://github.com/manuelvicnt/architecture-samples/blob/249a636ea9a3f16aab5c284e3245069ef56a557f/app/src/main/java/com/example/android/architecture/blueprints/todoapp/tasks/TasksFragment.kt&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;TasksFragment&lt;/code&gt; during the migration&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&quot;-challenges&quot;&gt;üßê Challenges&lt;/h2&gt;

&lt;p&gt;Not everything went as smoothly as it might have seemed. Even though converting Fragment content to Compose is straightforward, migrating from Navigation Fragments to Navigation Compose took a bit more time and consideration.&lt;/p&gt;

&lt;p&gt;There‚Äôs a need to expand and improve the guidance on different aspects that will make migrating to Compose easier in the future. This work sparked conversations and we hope to have new guidance on this soon! üéä&lt;/p&gt;

&lt;p&gt;As a Navigation beginner ‚úã and the person that handled the migration to Navigation Compose, I faced the following challenges:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;No code in the docs showed how to &lt;strong&gt;navigate with optional arguments&lt;/strong&gt;! Thanks to &lt;a href=&quot;https://github.com/chrisbanes/tivi/blob/main/app/src/main/java/app/tivi/AppNavigation.kt&quot;&gt;Tivi‚Äôs navigation graph&lt;/a&gt;, I found my way and solved the issue (follow the issue to improve the docs &lt;a href=&quot;https://issuetracker.google.com/226103829&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Migrating from a XML-based Navigation graph and SafeArgs to Kotlin DSL&lt;/strong&gt; should be a straightforward, mechanical task. However, it wasn‚Äôt &lt;em&gt;that&lt;/em&gt; easy for me considering I didn‚Äôt work on the original implementation. Some guidance about how to do it properly would‚Äôve helped me (follow the issue to improve the docs &lt;a href=&quot;https://issuetracker.google.com/226315955&quot;&gt;here&lt;/a&gt;).&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;More than a challenge, this point is a gotcha! &lt;strong&gt;&lt;a href=&quot;https://developer.android.com/guide/navigation/navigation-ui&quot;&gt;Navigation UI&lt;/a&gt; does some work for you already&lt;/strong&gt; when it comes to navigating. As this is not available in Compose, you need to keep an eye on that and do it manually. For example, keeping the backstack clean when navigating between Drawer‚Äôs screens requires special &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;NavigationOptions&lt;/code&gt; (see example &lt;a href=&quot;https://github.com/android/architecture-samples/blob/dev-compose/app/src/main/java/com/example/android/architecture/blueprints/todoapp/TodoNavigation.kt#L79&quot;&gt;here&lt;/a&gt;). This is already &lt;a href=&quot;https://developer.android.com/jetpack/compose/navigation#bottom-nav&quot;&gt;covered in the docs&lt;/a&gt;, but you need to be aware that you need it!&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;-conclusions&quot;&gt;üßë‚Äçüè´ Conclusions&lt;/h2&gt;

&lt;p&gt;Overall, migrating from Navigation Fragments to Navigation Compose was a fun task to do! Funnily enough, we spent more time waiting for peer reviews than migrating the project itself! Creating the migration plan and getting everyone on the same page definitely helped to set expectations early and alert peers of lengthy incoming reviews.&lt;/p&gt;

&lt;p&gt;We hope you enjoyed reading about our approach to migrating to Compose, and we‚Äôre looking forward to sharing more about the experiments and improvements we‚Äôll be doing in Architecture Blueprints.&lt;/p&gt;

&lt;p&gt;If you‚Äôre interested in seeing Blueprints with Compose code, take a look at the &lt;a href=&quot;https://github.com/android/architecture-samples/tree/dev-compose&quot;&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dev-compose&lt;/code&gt; branch&lt;/a&gt;. And in case you want to go through the PRs of the gradual migration, here‚Äôs the list:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;Statistics&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/821&quot;&gt;PR&lt;/a&gt;),&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Add/Edit task&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/823&quot;&gt;PR&lt;/a&gt;),&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Task detail&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/822&quot;&gt;PR&lt;/a&gt;),&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Tasks&lt;/em&gt; screen (&lt;a href=&quot;https://github.com/android/architecture-samples/pull/826&quot;&gt;PR&lt;/a&gt;); and&lt;/li&gt;
  &lt;li&gt;the &lt;a href=&quot;https://github.com/android/architecture-samples/pull/827&quot;&gt;final PR&lt;/a&gt; which migrated Navigation and Activity logic to Compose, including &lt;a href=&quot;https://github.com/android/architecture-samples/pull/827/commits/2810a37c479ef4b23b4cabf095c55df7b342235e&quot;&gt;removing unused View system dependencies&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;üëã&lt;/h2&gt;</content>

      
      
      
      
      

      <author>
          <name>Manuel Vivo</name>
        
        
      </author>

      

      
        <category term="architecture" />
      
        <category term="compose" />
      

      
        <summary type="html">This blog post tells the story of how the team migrated Architecture Blueprints to Jetpack Compose.</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">A Compose State of Mind</title>
      <link href="https://manuelvivo.dev/a-compose-state-of-mind" rel="alternate" type="text/html" title="A Compose State of Mind" />
      <published>2021-10-27T00:00:01+00:00</published>
      <updated>2021-10-27T00:00:01+00:00</updated>
      <id>https://manuelvivo.dev/a-compose-state-of-mind</id>
      <content type="html" xml:base="https://manuelvivo.dev/a-compose-state-of-mind">&lt;p&gt;A Compose State of Mind ‚Äî Android Dev Summit 2021 talk&lt;/p&gt;

&lt;h2 id=&quot;description&quot;&gt;Description&lt;/h2&gt;

&lt;p&gt;Jetpack Compose offers automatic state observation that recomposes or recreates your UI whenever state changes. Learn about Compose‚Äôs state model and the Composition, when to hoist state and create state holders or use AAC ViewModels, and how to mutate state when you‚Äôre outside the Composition safely so that these changes are tracked by Compose.&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/rmv2ug-wW4U&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h3 id=&quot;resources&quot;&gt;Resources&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://goo.gle/compose-docs&quot;&gt;Jetpack Compose documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://goo.gle/compose-pathway&quot;&gt;Jetpack Compose pathway&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://goo.gle/compose-samples&quot;&gt;Jetpack Compose samples&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.android.com/jetpack/compose/state&quot;&gt;State in Compose documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://developer.android.com/codelabs/jetpack-compose-state&quot;&gt;State in Compose codelab&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>

      
      
      
      
      

      <author>
          <name>Manuel Vivo</name>
        
        
      </author>

      

      
        <category term="talks" />
      
        <category term="compose" />
      

      
        <summary type="html">A Compose State of Mind ‚Äî Android Dev Summit 2021 talk</summary>
      

      
      
    </entry>
  
    <entry>
      <title type="html">Using Jetpack libraries in Compose talk</title>
      <link href="https://manuelvivo.dev/libraries-in-compose-talk" rel="alternate" type="text/html" title="Using Jetpack libraries in Compose talk" />
      <published>2021-05-18T00:00:00+00:00</published>
      <updated>2021-05-18T00:00:00+00:00</updated>
      <id>https://manuelvivo.dev/libraries-in-compose-talk</id>
      <content type="html" xml:base="https://manuelvivo.dev/libraries-in-compose-talk">&lt;p&gt;Using Jetpack libraries in Compose - Google I/O 2021 talk.&lt;/p&gt;

&lt;h2 id=&quot;description&quot;&gt;Description&lt;/h2&gt;

&lt;p&gt;Jetpack Compose integrates seamlessly with other Jetpack libraries. There‚Äôs no need to rewrite everything from scratch to start using Compose in your app. The UI code might change, but the rest of your app architecture remains intact. In this Session, we add Compose to an existing app that already uses ViewModel, LiveData/Flow, Paging, Room, Hilt, and Navigation! Learn how the libraries work with Compose, when to use ViewModels, and how to get the most out of Navigation Compose.&lt;/p&gt;

&lt;p&gt;Speakers: Ian Lake, Manuel Vicente Vivo&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/0z_dwBGQQWQ&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h3 id=&quot;resources&quot;&gt;Resources&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://goo.gle/compose-pathway&quot;&gt;Compose Pathway&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://goo.gle/compose-docs&quot;&gt;Compose documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://goo.gle/compose-samples&quot;&gt;Compose Samples&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content>

      
      
      
      
      

      <author>
          <name>Manuel Vivo</name>
        
        
      </author>

      

      
        <category term="talks" />
      
        <category term="compose" />
      

      
        <summary type="html">Using Jetpack libraries in Compose - Google I/O 2021 talk.</summary>
      

      
      
    </entry>
  
</feed>
